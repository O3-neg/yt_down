name: Build APK
on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    name: Build Android APK
    runs-on: ubuntu-20.04
    timeout-minutes: 90
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      
      - name: Build with Buildozer (Docker)
        id: buildozer
        uses: ArtemSBulgakov/buildozer-action@v1
        with:
          workdir: .
          buildozer_version: stable
      
      - name: Upload APK artifact
        uses: actions/upload-artifact@v3
        with:
          name: youtube-downloader-apk
          path: ${{ steps.buildozer.outputs.filename }}
          if-no-files-found: error
      
      - name: Create Release
        if: success() && github.ref == 'refs/heads/main'
        uses: softprops/action-gh-release@v1
        with:
          files: ${{ steps.buildozer.outputs.filename }}
          tag_name: v2.0-build${{ github.run_number }}
          name: YouTube Downloader v2.0 (Build ${{ github.run_number }})
          body: |
            ## ðŸ“± YouTube Downloader v2.0
            
            ### âœ¨ Build AutomÃ¡tico #${{ github.run_number }}
            
            **ðŸ“¥ Como instalar:**
            1. Baixe o arquivo APK abaixo
            2. No Android, habilite "Fontes desconhecidas" nas configuraÃ§Ãµes
            3. Instale o APK
            
            **ðŸŽ¯ Funcionalidades:**
            - âœ… Download de vÃ­deos do YouTube
            - âœ… Download de playlists completas
            - âœ… ConversÃ£o para MP3/MP4
            - âœ… Sistema de cache inteligente
            
            ---
            ðŸ”¨ Commit: `${{ github.sha }}`
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
